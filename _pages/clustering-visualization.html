---
layout: blank
title: "Clustering Visualization"
permalink: /clustering-visualization/
noindex: true
---

<div class="viz-page fullwidth">
  <div class="controls">
    <label for="questionSelect">Question:</label>
    <select id="questionSelect"></select>
  </div>
  <div id="plot" class="plot"></div>
  <div id="documentText" class="doc-panel" style="display:none"></div>
</div>

<style>
  html, body, .fullwidth { margin: 0; padding: 0; }
  body { background-color: #f5f5f5; }
  .viz-page { padding: 16px; }
  .controls { margin-bottom: 12px; }
  .plot { width: 100%; height: 70vh; background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  .doc-panel { margin-top: 16px; padding: 15px; border: 1px solid #ccc; border-radius: 6px; background-color: #f9f9f9; min-height: 100px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; }
  .document-title { font-weight: bold; font-size: 1.1em; margin-bottom: 8px; color: #333; }
</style>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<!-- Removed inline _data JSON; now we fetch from clustering_visualization.html -->
<script>
  (function() {
    var basePath = "{{ base_path }}" || "";
    var selectEl = document.getElementById('questionSelect');
    var plotEl = document.getElementById('plot');
    var docEl = document.getElementById('documentText');
    var allQuestions = [];

    function loadFromStaticFile() {
      var url = basePath + '/clustering_visualization.html';
      return fetch(url)
        .then(function(resp) { return resp.text(); })
        .then(function(text) {
          var match = text.match(/const\s+plotData\s*=\s*(\[[\s\S]*?\])\s*;/);
          if (!match) throw new Error('plotData not found');
          return JSON.parse(match[1]);
        });
    }

    function populateSelect() {
      selectEl.innerHTML = '';
      for (var i = 0; i < (allQuestions || []).length; i++) {
        var opt = document.createElement('option');
        opt.value = String(i);
        opt.textContent = 'Question ' + (i + 1);
        selectEl.appendChild(opt);
      }
    }

    function renderQuestion(idx) {
      var traces = (allQuestions && allQuestions[idx]) ? allQuestions[idx] : [];
      var layout = { title: '', autosize: true, margin: { l: 40, r: 20, t: 16, b: 40 }, xaxis: { zeroline: false }, yaxis: { zeroline: false } };
      var config = { responsive: true, displayModeBar: true };
      Plotly.react(plotEl, traces, layout, config);
      docEl.style.display = 'none';
      docEl.innerHTML = '';
    }

    function onPointClick(event) {
      if (!event || !event.points || !event.points.length) return;
      var p = event.points[0];
      var meta = p.customdata || {};
      var title = meta.title || 'Document';
      var text = meta.text || '';
      docEl.innerHTML = '<div class="document-title">' + title + '</div>' + text;
      docEl.style.display = 'block';
    }

    function updateVisualization() {
      var idx = parseInt(selectEl.value || '0', 10) || 0;
      renderQuestion(idx);
    }

    // Initialize
    loadFromStaticFile().then(function(data) {
      allQuestions = Array.isArray(data) ? data : [];
      if (!allQuestions.length) throw new Error('Empty data array');
      populateSelect();
      selectEl.value = '0';
      updateVisualization();
    }).catch(function(err) {
      plotEl.innerHTML = '<p style="color:red;padding:12px;">Failed to load data from clustering_visualization.html (' + (err && err.message ? err.message : 'unknown error') + ').</p>';
    });

    selectEl.addEventListener('change', updateVisualization);
    plotEl.addEventListener('plotly_click', onPointClick);
  })();
</script> 